{% load static tailwind_tags %} 
<!DOCTYPE html> 
<html lang="es"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<title>{% block title %}SaludTotal - Sistema Médico Avanzado{% endblock %}</title>
{% tailwind_css %}
{% block extra_head %}{% endblock %}
<style>
:root {
    --bg-primary: #0f0f23;
    --bg-secondary: #18182f;
    --bg-tertiary: #1a1a2e;
    --hud-cyan: #00f5ff;
    --hud-blue: #667eea;
    --hud-violet: #764ba2;
    --hud-glow: 0 0 18px #00f5ffcc, 0 0 8px #764ba2cc;
    --hud-glass: rgba(30, 40, 60, 0.55);
    --hud-border: rgba(0,245,255,0.18);
    --hud-shadow: 0 8px 32px 0 #00f5ff22, 0 0 0 2px var(--primary-gradient), 0 1.5px 8px #667eea22;
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00f5ff 100%);
    --secondary-gradient: linear-gradient(135deg, #00f5ff 0%, #00d4aa 100%);
    --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-border: rgba(0,245,255,0.18);
    --glass-shadow: 0 8px 32px rgba(0, 245, 255, 0.13);
    --neon-glow: 0 0 20px #00f5ffcc, 0 0 8px #764ba2cc;
    --neon-glow-hover: 0 0 30px #00f5ff, 0 0 12px #764ba2;
    --hologram-gradient: linear-gradient(270deg, #667eea 0%, #764ba2 50%, #00f5ff 100%);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: var(--bg-primary) !important;
  color: #eaf6ff;
  font-family: 'Inter', 'Orbitron', 'Exo 2', 'Space Mono', monospace, sans-serif;
  letter-spacing: 0.01em;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}
body::before,
body::after {
  content: none !important;
  display: none !important;
  background: none !important;
  background-image: none !important;
  box-shadow: none !important;
}
/* ===== LOADER FUTURISTA MÉDICO (EXTRAÍDO) ===== */
#medicalLoading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 20000;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
    backdrop-filter: blur(20px);
    overflow: hidden;
    font-family: 'Inter', sans-serif;
    opacity: 1;
    visibility: visible;
    pointer-events: all;
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
}
#medicalLoading.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}
.particles {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
}
.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
    animation: float-particles 8s infinite linear;
}
.particle:nth-child(odd) {
    background: rgba(102, 126, 234, 0.8);
    animation-duration: 12s;
}
.particle:nth-child(3n) {
    background: rgba(79, 172, 254, 0.6);
    animation-duration: 10s;
}
@keyframes float-particles {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10%, 90% { opacity: 1; }
    100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
}
.radar-container {
    position: absolute;
    width: 600px;
    height: 600px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
}
.radar-wave {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid rgba(102, 126, 234, 0.3);
    border-radius: 50%;
    animation: radar-pulse 3s infinite ease-out;
}
.radar-wave:nth-child(2) { animation-delay: 1s; }
.radar-wave:nth-child(3) { animation-delay: 2s; }
@keyframes radar-pulse {
    0% { transform: scale(0); opacity: 1; }
    100% { transform: scale(1); opacity: 0; }
}
.glow-effect {
    position: absolute;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: glow-pulse 4s ease-in-out infinite;
    z-index: -1;
}
@keyframes glow-pulse {
    0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.2); }
}
.loading-container {
    text-align: center;
    position: relative;
    z-index: 10;
}
.hexagon-container {
    position: relative;
    margin-bottom: 3rem;
}
.orbit {
    position: absolute;
    border: 1px solid rgba(79, 172, 254, 0.4);
    border-radius: 50%;
    animation: orbit-rotate 8s linear infinite;
}
.orbit-1 {
    width: 220px;
    height: 220px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
.orbit-2 {
    width: 280px;
    height: 280px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation-duration: 12s;
    animation-direction: reverse;
}
@keyframes orbit-rotate {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}
.orbit-item {
    position: absolute;
    width: 12px;
    height: 12px;
    background: linear-gradient(135deg, #00f5ff 0%, #00d4aa 100%);
    border-radius: 50%;
    box-shadow: 0 0 15px rgba(79, 172, 254, 0.8);
}
.orbit-1 .orbit-item { top: -6px; left: 50%; transform: translateX(-50%); }
.orbit-2 .orbit-item { top: -6px; right: -6px; }
.hexagon {
    width: 180px;
    height: 180px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: hexagon-float 4s ease-in-out infinite;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.2);
}
@keyframes hexagon-float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(3deg); }
}
.medical-icon {
    font-size: 5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: icon-glow 2s ease-in-out infinite alternate;
}
@keyframes icon-glow {
    0% { filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5)); transform: scale(1); }
    100% { filter: drop-shadow(0 0 30px rgba(102, 126, 234, 0.8)); transform: scale(1.05); }
}
.loading-title {
    font-family: 'Orbitron', monospace;
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffffff 0%, #4facfe 50%, #00f2fe 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    animation: title-pulse 3s ease-in-out infinite;
    text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
}
@keyframes title-pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.02); }
}
.loading-subtitle {
    font-family: 'Inter', sans-serif;
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 3rem;
    font-weight: 300;
    letter-spacing: 1px;
}
.progress-container {
    width: 400px;
    margin: 0 auto 2rem;
    position: relative;
}
.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}
.progress-fill {
    height: 100%;
    background: linear-gradient(135deg, #00f5ff 0%, #00d4aa 100%);
    border-radius: 10px;
    width: 0%;
    transition: width 2.5s linear;
    position: relative;
    box-shadow: 0 0 20px rgba(79, 172, 254, 0.6);
}
.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s infinite;
}
@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}
.status-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    width: 400px;
    margin: 0 auto;
}
.status-item {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    animation: status-check 6s infinite;
}
.status-item:nth-child(1) { animation-delay: 0s; }
.status-item:nth-child(2) { animation-delay: 2s; }
.status-item:nth-child(3) { animation-delay: 4s; }
@keyframes status-check {
    0%, 80% { border-color: rgba(255, 255, 255, 0.2); box-shadow: none; }
    85%, 95% { border-color: rgba(79, 172, 254, 0.8); box-shadow: 0 0 20px rgba(79, 172, 254, 0.4); background: rgba(79, 172, 254, 0.1); }
    100% { border-color: rgba(86, 171, 47, 0.8); box-shadow: 0 0 20px rgba(86, 171, 47, 0.4); background: rgba(86, 171, 47, 0.1); }
}
.status-icon {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 0.5rem;
    display: block;
}
.status-text {
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
}
@media (max-width: 768px) {
    .loading-title { font-size: 2rem; }
    .progress-container, .status-grid { width: 90%; }
    .hexagon { width: 150px; height: 150px; }
    .medical-icon { font-size: 4rem; }
    .orbit-1 { width: 190px; height: 190px; }
    .orbit-2 { width: 240px; height: 240px; }
}
/* Estilos del encabezado */
header {
  background: linear-gradient(120deg, #18182f 80%, #00f5ff11 100%) !important;
  border-bottom: 1.5px solid var(--glass-border) !important;
  box-shadow: 0 2px 32px #00f5ff22, 0 1.5px 8px #667eea22;
  backdrop-filter: blur(18px) !important;
  position: sticky;
  top: 0;
  z-index: 100;
}
header .max-w-7xl {
  position: relative;
  z-index: 10;
  padding-top: 1.2rem !important;
  padding-bottom: 1.2rem !important;
}
header::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 100%;
  background: linear-gradient(90deg, #00f5ff22 0%, #764ba222 100%);
  z-index: -1;
  pointer-events: none;
}
header h1 {
  font-family: 'Orbitron', monospace;
  font-size: 2rem;
  background: var(--primary-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 0 18px #00f5ff88, 0 0 8px #764ba288;
  letter-spacing: 1.2px;
}
header p {
  color: #b6eaff;
  font-family: 'Exo 2', monospace;
  font-size: 1rem;
  letter-spacing: 1.2px;
}
header .w-10.h-10 {
  background: var(--primary-gradient) !important;
  box-shadow: 0 0 18px #00f5ff55, 0 0 8px #764ba255;
  border-radius: 10px !important;
}
header svg {
  filter: drop-shadow(0 0 8px #00f5ff88);
}
#userDropdown, .dropdown-menu, #userDropdownMenu {
  background: var(--hud-glass) !important;
  border: 1.5px solid var(--hud-border) !important;
  box-shadow: var(--hud-shadow) !important;
  color: #eaf6ff !important;
  backdrop-filter: blur(18px) !important;
}
#userDropdown {
  transition: box-shadow 0.3s, border 0.3s, background 0.3s;
  box-shadow: 0 2px 16px #00f5ff33, 0 0 0 2px var(--primary-gradient);
  border-radius: 2rem !important;
  background: var(--glass-bg) !important;
}
#userDropdown:hover, #userDropdown:focus {
  box-shadow: 0 0 32px #00f5ffcc, 0 2px 8px #667eea55;
  border: 1.5px solid #00f5ffcc;
  background: var(--glass-bg) !important;
}
#userDropdownMenu {
  background: var(--hud-glass) !important;
  border: 1.5px solid var(--hud-border) !important;
  box-shadow: 0 8px 32px #00f5ff33, 0 0 0 2px var(--primary-gradient);
  border-radius: 1.2rem !important;
  color: #eaf6ff !important;
  margin-top: 0.7rem !important;
}
#userDropdownMenu a, #userDropdownMenu button {
  color: #eaf6ff !important;
  background: none !important;
  border-radius: 0.7rem !important;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
  font-family: 'Exo 2', monospace;
}
#userDropdownMenu a:hover, #userDropdownMenu button:hover {
  background: linear-gradient(90deg, #00f5ff22 0%, #764ba222 100%) !important;
  color: #00f5ff !important;
  box-shadow: 0 0 18px #00f5ff55;
}
#userDropdownMenu .text-red-600, #userDropdownMenu .text-red-500 {
  color: #ff6b6b !important;
}
#userDropdownMenu .hover\:bg-red-50:hover {
  background: linear-gradient(90deg, #ff6b6b22 0%, #ffa72622 100%) !important;
  color: #ff6b6b !important;
}
.main-content {
  background: var(--hud-glass) !important;
  border: 1.5px solid var(--hud-border) !important;
  border-radius: 1.1rem !important;
  box-shadow: 0 4px 24px #00f5ff18, 0 0 0 1.5px var(--primary-gradient), 0 1.5px 8px #667eea18 !important;
  padding: 2.2rem 2rem 1.7rem 2rem !important;
  margin-top: 1.5rem !important;
  margin-bottom: 2.2rem !important;
  position: relative;
  z-index: 5;
  backdrop-filter: blur(22px) !important;
  overflow: visible;
}
.main-content::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(120deg, #00f5ff11 0%, #764ba211 100%);
  z-index: -1;
  border-radius: 1.1rem;
  pointer-events: none;
}
/* Glowing navigation icons */
header svg, #userDropdownMenu svg {
  filter: drop-shadow(0 0 8px #00f5ff88) drop-shadow(0 0 4px #764ba288);
}
/* HUD floating panel effect */
.hud-panel {
  background: var(--hud-glass);
  border: 1.5px solid var(--hud-border);
  border-radius: 1.5rem;
  box-shadow: 0 8px 32px #00f5ff22, 0 0 0 2px var(--primary-gradient);
  backdrop-filter: blur(18px);
  padding: 1.5rem 2rem;
  margin-bottom: 2rem;
  position: relative;
  z-index: 2;
}
.hud-panel::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(120deg, #00f5ff11 0%, #764ba211 100%);
  z-index: -1;
  border-radius: 1.5rem;
  pointer-events: none;
}
/* Sci-fi glowing divider */
.hud-divider {
  height: 2px;
  width: 100%;
  background: linear-gradient(90deg, #00f5ff 0%, #764ba2 100%);
  box-shadow: 0 0 12px #00f5ff88;
  border-radius: 2px;
  margin: 2rem 0;
  opacity: 0.7;
}
/* Holographic floating effect */
.hud-holo {
  background: linear-gradient(120deg, #00f5ff22 0%, #764ba222 100%);
  border-radius: 1.2rem;
  box-shadow: 0 0 32px #00f5ff33, 0 0 0 2px var(--primary-gradient);
  padding: 1.2rem 1.5rem;
  margin-bottom: 1.5rem;
  position: relative;
  z-index: 1;
  border: 1.5px solid var(--hud-border);
  backdrop-filter: blur(12px);
}
/* Estilos del menú desplegable de usuario */
#userDropdownMenu {
    background: var(--bg-tertiary);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 0.5rem 0;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
}
#userDropdownMenu::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%);
    transform: translateX(-50%) rotate(2deg);
    z-index: -1;
}
header .flex.items-center.space-x-4 > div:first-child {
  margin-right: 1.5rem !important;
}
header .flex.items-center.space-x-4 > div:nth-child(2) {
  margin-left: 0.5rem !important;
}
@media (max-width: 640px) {
  .main-content, .glass-effect, .home-hud-panel {
    padding: 1.2rem 0.7rem 1rem 0.7rem !important;
    border-radius: 0.7rem !important;
  }
  .status-module, .module-card {
    border-radius: 0.5rem !important;
    padding: 0.7rem 0.5rem 0.5rem 0.5rem !important;
  }
}
</style>
</head>
<body> 
<!-- Loading Animado Futurista Global -->
<div id="medicalLoading">
    <!-- Partículas flotantes -->
    <div class="particles">
        <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; animation-delay: 1s;"></div>
        <div class="particle" style="left: 30%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 40%; animation-delay: 3s;"></div>
        <div class="particle" style="left: 50%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 60%; animation-delay: 5s;"></div>
        <div class="particle" style="left: 70%; animation-delay: 6s;"></div>
        <div class="particle" style="left: 80%; animation-delay: 7s;"></div>
        <div class="particle" style="left: 90%; animation-delay: 8s;"></div>
    </div>
    <!-- Ondas de radar -->
    <div class="radar-container">
        <div class="radar-wave"></div>
        <div class="radar-wave"></div>
        <div class="radar-wave"></div>
    </div>
    <!-- Efecto de resplandor -->
    <div class="glow-effect"></div>
    <!-- Contenedor principal -->
    <div class="loading-container">
        <!-- Hexágono con icono -->
        <div class="hexagon-container">
            <!-- Órbitas -->
            <div class="orbit orbit-1">
                <div class="orbit-item"></div>
            </div>
            <div class="orbit orbit-2">
                <div class="orbit-item"></div>
            </div>
            <!-- Hexágono principal -->
            <div class="hexagon">
                <i class="fas fa-user-md medical-icon"></i>
            </div>
        </div>
        <!-- Textos -->
        <h2 class="loading-title">SISTEMA MÉDICO</h2>
        <p class="loading-subtitle">Inicializando protocolo avanzado...</p>
        <!-- Barra de progreso -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        <!-- Estados del sistema -->
        <div class="status-grid">
            <div class="status-item">
                <i class="fas fa-database status-icon"></i>
                <div class="status-text">Base de Datos</div>
            </div>
            <div class="status-item">
                <i class="fas fa-shield-alt status-icon"></i>
                <div class="status-text">Seguridad</div>
            </div>
            <div class="status-item">
                <i class="fas fa-heartbeat status-icon"></i>
                <div class="status-text">Monitoreo</div>
            </div>
        </div>
    </div>
</div>
<!-- Elimina el contenedor extra para evitar doble caja -->
{% block navBar %}
   <header class="bg-transparent border-b-0 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-4" style="margin-left: 0.7rem;">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center ml-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold" style="color:#fff;">SaludTotal</h1>
                        <p class="text-sm" style="color:#c7c7e6;">Lo mejor en Atención</p>
                    </div>
                </div>

                <!-- User Profile / Login -->
                <div class="flex items-center space-x-4">
                    {% if user.is_authenticated %}
                        <!-- Groups Selector -->
                        <div class="relative">
                            <select id="groupSelect" class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 shadow-md hover:shadow-lg">
                                <option value="">Seleccionar Grupo</option>
                                {% for group in group_list %}
                                    <option value="{{ group.id }}" {% if request.GET.gpid == group.id|stringformat:"s" %}selected{% endif %}>
                                        {{ group.name }}
                                    </option>
                                {% empty %}
                                    <option value="" disabled>Sin grupos asignados</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- User Dropdown -->
                        <div class="relative">
                            <button id="userDropdown" class="flex items-center space-x-3 bg-white rounded-full shadow-lg px-4 py-2 hover:shadow-xl transition-all duration-300 transform hover:scale-105 relative z-10">
                                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="text-left truncate max-w-[7rem]">
                                    <span class="text-gray-700 font-medium block truncate">{{ user.username }}</span>
                                    {% if group_list.exists %}
                                        <span class="text-xs text-gray-500 truncate">{{ group.name }}</span>
                                    {% endif %}
                                </div>
                                <svg class="w-4 h-4 text-gray-500 transform transition-transform duration-200" id="userDropdownIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="userDropdownMenu" class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-200 opacity-0 invisible scale-95 origin-top-right transition-all duration-200 z-50 overflow-visible max-h-none p-0">
                                <div class="py-2">
                                    <!-- User Info -->
                                    <div class="px-4 py-3 border-b border-gray-100">
                                        <p class="text-sm font-medium text-gray-900 truncate">{{ user.username }}</p>
                                        <p class="text-sm text-gray-500 truncate">{{ user.email|default:"Sin email" }}</p>
                                        {% if user.group.exists %}
                                            <div class="mt-2">
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 truncate">
                                                    {{ user.group.name }}
                                                </span>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Menu Items -->
                                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        Mi Perfil
                                    </a>
                                    
                                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        Configuración
                                    </a>
                                    
                                    <div class="border-t border-gray-100 my-1"></div>
                                    
                                    <form method="POST" action="{% url 'security:signout' %}" class="block">
                                        {% csrf_token %}
                                        <button type="submit" class="flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200">
                                            <svg class="w-4 h-4 mr-3 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 0v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v8a4 4 0 004 4h3a4 4 0 004-4v-2"></path>
                                            </svg>
                                            Cerrar Sesión
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <!-- Login Button -->
                        <a href="{% url 'security:signin' %}" class="flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium px-6 py-2 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                            </svg>
                            <span>Iniciar Sesión</span>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>
{% endblock navBar %} 
{% block js %}
 <script>
    document.addEventListener('DOMContentLoaded', function() {
    const userDropdown = document.getElementById('userDropdown');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    const userDropdownIcon = document.getElementById('userDropdownIcon');
    
    if (userDropdown && userDropdownMenu) {
        function hideDropdown() {
            userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
            userDropdownMenu.classList.remove('opacity-100', 'visible', 'scale-100');
            if (userDropdownIcon) userDropdownIcon.classList.remove('rotate-180');
        }
        function showDropdown() {
            userDropdownMenu.classList.remove('opacity-0', 'invisible', 'scale-95');
            userDropdownMenu.classList.add('opacity-100', 'visible', 'scale-100');
            if (userDropdownIcon) userDropdownIcon.classList.add('rotate-180');
        }
        function isDropdownOpen() {
            return userDropdownMenu.classList.contains('opacity-100') && userDropdownMenu.classList.contains('visible') && userDropdownMenu.classList.contains('scale-100');
        }
        userDropdown.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (isDropdownOpen()) {
                hideDropdown();
            } else {
                showDropdown();
            }
        });
        document.addEventListener('click', function(e) {
            if (!userDropdown.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                hideDropdown();
            }
        });
        userDropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
        // Always start hidden
        hideDropdown();
    }

    // Groups selector functionality
    const groupsSelector = document.querySelector('select');
    if (groupsSelector) {
        groupsSelector.addEventListener('change', function() {
            const selectedGroup = this.value;
            if (selectedGroup) {
                // Here you can add functionality to handle group selection
                console.log('Selected group:', selectedGroup);
                // You could make an AJAX request to change the user's active group
                // or redirect to a filtered view
            }
        });
    }

// Add smooth entrance animations
    // Animate stats cards
    const statsCards = document.querySelectorAll('.grid > div');
    statsCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease-out';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Add click ripple effect to buttons
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (this.disabled) return;
            
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.classList.add('ripple');
            
            this.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });

    // Smooth scroll to modules on stats card click
    statsCards.forEach(card => {
        card.addEventListener('click', function() {
            document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3').scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
});
// Add intersection observer for animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.animation = 'slideInRight 0.6s ease-out forwards';
        }
    });
}, observerOptions);

// Observe all module cards
document.querySelectorAll('.module-card').forEach(card => {
    observer.observe(card);
});
// Corregido: solo agregar eventListener si existe el elemento
const groupSelectEl = document.getElementById('groupSelect');
if (groupSelectEl) {
    groupSelectEl.addEventListener('change', function() {
        const selectedGroupId = this.value;
        if (selectedGroupId) {
            window.location.href = `{% url 'home' %}?gpid=${selectedGroupId}`;
        } else {
            window.location.href = `{% url 'home' %}`;
        }
    });
}
// Asegura que el contenido principal esté oculto hasta que termine el loading
class MedicalLoader {
    constructor() {
        this.loader = document.getElementById('medicalLoading');
        this.progressFill = document.getElementById('progressFill');
        this.mainContent = document.querySelector('.main-content');
        this.isLoading = true;
        this.init();
    }
    init() {
        this.showLoader();
        this.simulateLoading();
    }
    showLoader() {
        if (!this.loader) return;
        this.loader.style.display = 'flex';
        this.loader.style.opacity = '1';
        this.loader.style.visibility = 'visible';
        this.loader.style.pointerEvents = 'all';
        if (this.mainContent) {
            this.mainContent.style.opacity = '0';
            this.mainContent.style.pointerEvents = 'none';
        }
    }
    simulateLoading() {
        setTimeout(() => {
            if (this.progressFill) {
                this.progressFill.style.width = '100%';
            }
        }, 100);
        setTimeout(() => {
            this.hideLoader();
        }, 3500);
    }
    hideLoader() {
        if (!this.loader) return;
        this.loader.classList.add('hidden');
        setTimeout(() => {
            this.loader.style.display = 'none';
            if (this.mainContent) {
                this.mainContent.style.opacity = '1';
                this.mainContent.style.pointerEvents = 'auto';
            }
            this.isLoading = false;
        }, 500);
    }
    show() {
        this.isLoading = true;
        this.showLoader();
        if (this.progressFill) {
            this.progressFill.style.transition = 'none';
            this.progressFill.style.width = '0%';
            setTimeout(() => {
                this.progressFill.style.transition = 'width 2.5s linear';
                this.progressFill.style.width = '100%';
            }, 50);
        }
    }
    hide() {
        this.hideLoader();
    }
}
(function() {
    function startLoader() {
        window.medicalLoader = new MedicalLoader();
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', startLoader);
    } else {
        startLoader();
    }
    window.toggleLoader = function() {
        if (window.medicalLoader) {
            if (window.medicalLoader.isLoading) {
                window.medicalLoader.hide();
            } else {
                window.medicalLoader.show();
                setTimeout(() => window.medicalLoader.hide(), 3500);
            }
        }
    };
    document.addEventListener('keydown', function(e) {
        if (e.key === 'l' && e.ctrlKey) {
            e.preventDefault();
            window.toggleLoader();
        }
    });
})();
 </script>
<script>
(function() {
  const dropdownBtn = document.getElementById('userDropdown');
  const dropdownMenu = document.getElementById('userDropdownMenu');
  if (!dropdownBtn || !dropdownMenu) return;

  // Si tu icono tiene una clase específica, ajústala aquí
  const icon = dropdownBtn.querySelector('.dropdown-icon');

  function showMenu() {
    dropdownMenu.classList.remove('opacity-0', 'invisible', 'scale-95');
    if (icon) icon.classList.add('rotate-180');
  }

  function hideMenu() {
    dropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
    if (icon) icon.classList.remove('rotate-180');
  }

  function toggleMenu(e) {
    e.stopPropagation();
    const isHidden = dropdownMenu.classList.contains('invisible');
    if (isHidden) {
      showMenu();
    } else {
      hideMenu();
    }
  }

  dropdownBtn.addEventListener('click', toggleMenu);

  document.addEventListener('click', function(e) {
    if (!dropdownMenu.classList.contains('invisible') && !dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
      hideMenu();
    }
  });

  hideMenu();
})();
</script>
{% endblock %}
{% block extra_js %}{% endblock %}
{% block content %}{% endblock content %}
</body> 
</html>